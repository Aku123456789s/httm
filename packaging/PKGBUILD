pkgname=httm
pkgver=0.10.9
pkgrel=1
pkgdesc="The dream of a CLI ZFS Time Machine is still alive with httm. Httm prints the size, date and corresponding locations of available unique versions (deduplicated by modify time and size) of files residing on ZFS snapshots, but can also be used interactively to select and restore such files."
arch=('x86_64')
url="https://github.com/kimono-koans/httm/blob/master/README.md"
license=('MPL-2.0')
groups=('utility')
options=('!strip' '!emptydirs')
makedepends=('git' 'rustup')
source=("$pkgver.tar.gz::https://github.com/kimono-koans/httm/archive/refs/tags/$pkgver.tar.gz")
sha512sums=('35e9e6864753031318ba683b6a8f6a48323c5d83fa6c3478c5bc62f2feec22a49fd71195cd1001030333e78c8131071b05e2ebadda5775ba094cfe977e5daf15')

build(){
	# install a stable rust toochain to build
	rustup toolchain install stable
	# install latest with cargo install --git https://github.com/kimono-koans/httm.git
	cd "${srcdir}/httm-$pkgver"; cargo build --release
	cd -
}

package(){

	mkdir -p "${pkgdir}/usr/bin"
    cp "${srcdir}/target/release/httm" "${pkgdir}/usr/bin/"
	chmod 755 "${pkgdir}/usr/bin/httm"

	mkdir -p "${pkgdir}/usr/share/man/man1"
    cp "${srcdir}/httm.1" "${pkgdir}/usr/share/man/man1/"
	chmod 644 "${pkgdir}/usr/share/man/man1/httm.1"

	mkdir -p "${pkgdir}/usr/share/doc/httm"
    cp "${srcdir}/README.md" "${pkgdir}/usr/share/doc/httm/"
	chmod 644 "${pkgdir}/usr/share/doc/httm/README.md"

}